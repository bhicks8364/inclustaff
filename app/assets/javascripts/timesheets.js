// Generated by CoffeeScript 1.7.1
(function() {
  var Timesheet, TimesheetList,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  TimesheetList = (function() {
    function TimesheetList(item) {
      this.item = $(item);
      this.timesheets = $.map(this.item.find("[data-behavior='timesheet']"), function(item, i) {
        return new Timesheet(item);
      });
    }

    return TimesheetList;

  })();

  Timesheet = (function() {
    function Timesheet(item) {
      this.handleToggleSuccess = __bind(this.handleToggleSuccess, this);
      this.handleToggle = __bind(this.handleToggle, this);
      this.item = $(item);
      console.log(this.item);
      console.log(this.position);
      this.id = this.item.data("id");
      this.setEvents();
    }

    Timesheet.prototype.setEvents = function() {
      return this.item.find("[data-behavior='timesheet-toggle']").on("click", this.handleToggle);
    };

    Timesheet.prototype.handleToggle = function() {
      return $.ajax({
        url: "/admin/timesheets/" + this.id + "/approve",
        method: "PATCH",
        dataType: "JSON",
        success: this.handleToggleSuccess
      });
    };

    Timesheet.prototype.handleToggleSuccess = function(data) {
      if (data.approved) {
        this.item.removeClass('item-left').addClass('item-right');
        this.item.find("[data-behavior='approve-button']").html("<i class='fa fa-square-o fa-stack-2x'></i><i class='fa fa-times fa-stack-1x'></i>");
        console.log(this.item);
        console.log(data.state);
      } else {
        this.item.removeClass('item-right').addClass('item-left');
        this.item.find("[data-behavior='approve-button']").html("<i class='fa fa-square-o fa-stack-2x'></i><i class='fa fa-check fa-stack-1x'></i>");
      }
      if (data.clocked_in) {
        alert("" + data.name + " is currently clocked in. Please clock them out before editing their timesheet.");
        this.item.find("[data-behavior='timesheet-state']").html("" + data.state);
        console.log(data.id);
        return console.log(data.state);
      }
    };

    return Timesheet;

  })();

  jQuery(function() {
    return new TimesheetList($("[data-behavior='timesheet-list']"));
  });

}).call(this);
